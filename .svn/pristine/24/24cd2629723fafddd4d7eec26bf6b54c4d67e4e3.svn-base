<template>
  <div class="container-fluid">
    <div class="row">
      <PageHeader :pageCurrentInfo="pageCurrentInfo" />
              <div class="col-sm-12">

            <!-- 작성영역 시작-->
            <div class="widget has-shadow">
                <div class="widget-body">
                    <table class="table table-bordered" summary="품목 등록">
                        <colgroup>
                            <col width="10%">
                            <col width="40%">
                            <col width="10%">
                            <col width="40%">
                        </colgroup>
                        <tbody>
                            <tr>
                                <th scope="row"><span class="text-primary">분류</span></th>
                                <td colspan="7">
                                    <div class="row">
                                        <div class="col col-sm-2">
                                            <select class="form-control" v-model="cboBicCodeVal" @change="changeCboBicCode">
                                              <option value=''>전체</option>
                                              <option v-for="x in cboBicCodeList" :key="x.icCodeNo" :value="x.icCodeNo">{{x.icCodeName}}</option>
                                            </select>
                                        </div>
                                        <div class="col col-sm-2">
                                            <select class="form-control" v-model="cboMidCodeVal" @change="changeCboMidCode">
                                              <option value=''>전체</option>
                                              <option v-for="x in cboMidCodeList" :key="x.icCodeNo" :value="x.icCodeNo">{{x.icCodeName}}</option>
                                            </select>
                                        </div>
                                        <div class="col col-sm-2">
                                            <select class="form-control" v-model="cboSmallCodeVal">
                                              <option value=''>전체</option>
                                              <option v-for="x in cboSmallCodeList" :key="x.icCodeNo" :value="x.icCodeNo">{{x.icCodeName}}</option>
                                            </select>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row"><span class="text-primary">품목명</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col col-sm-4">
                                            <input type="text" class="form-control" v-model="itemDetail.itemName" placeholder="">
                                        </div>
                                    </div>
                                </td>
                                <th><span class="text-primary">품목코드</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col col-sm-4">
                                            <input type="text" class="form-control" v-model="itemDetail.itemId" readonly placeholder="자동 생성입니다.">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row"><span class="text-primary">관리 번호</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col-sm-4">
                                            <input type="text" class="form-control" v-model="itemDetail.iedtBarcode" placeholder="">
                                        </div>
                                    </div>
                                </td>
                                <th><span class="text-primary">규격</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col-sm-4">
                                            <input type="text" class="form-control" v-model="itemDetail.itemStandard" placeholder="">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row"><span class="text-primary">저자/출판사</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">저자</span>
                                                <input type="text" class="form-control" v-model="itemDetail.itemAuthor" placeholder="">
                                            </div>
                                        </div>
                                        <div class="col col-sm-4">
                                            <div class="input-group">
                                                    <span class="input-group-addon">출판사</span>
                                                    <input type="text" class="form-control" v-model="itemDetail.itemManufacture" placeholder="">
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <th><span class="text-primary">브랜드</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col col-sm-3">
                                            <select class="form-control" v-model="itemDetail.itemBrandNo">
                                                <option value=null>선택하세요</option>
                                                <option v-for="x in cboBrandList" :key="x.brandNo" :value="x.brandNo">{{x.brandName}}</option>
                                            </select>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row"><span class="text-primary">Year/Pages</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">Year</span>
                                                <input type="text" class="form-control" v-model="itemDetail.itemYear" placeholder="">
                                            </div>
                                        </div>
                                        <div class="col col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">Pages</span>
                                                <input type="text" class="form-control" v-model="itemDetail.itemPage" placeholder="">
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <th><span class="text-primary">옵션정보</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col col-sm-6">
                                            <div class="input-group">
                                                <span class="input-group-addon" style="font-weight:bold">CD</span>
                                                 <div class="styled-radio">
                                                    <input type="radio" name="rdoCd" id="rdoCd-1" value="Y" v-model="itemDetail.itemCdYn">
                                                    <label for="rdoCd-1">있음</label>
                                                 </div>
                                                 <div class="styled-radio">
                                                    <input type="radio" name="rdoCd" id="rdoCd-2" value="N" v-model="itemDetail.itemCdYn">
                                                    <label for="rdoCd-2">없음</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col col-sm-6">
                                            <div class="input-group">
                                                <span class="input-group-addon" style="font-weight:bold">EBOOK</span>
                                                <div class="styled-radio">
                                                    <input type="radio" name="rdoEbook" id="rdoEbook-1" value="Y" v-model="itemDetail.itemEbookYn">
                                                    <label for="rdoEbook-1">있음</label>
                                                </div>
                                                <div class="styled-radio">
                                                    <input type="radio" name="rdoEbook" id="rdoEbook-2" value="N" v-model="itemDetail.itemEbookYn">
                                                    <label for="rdoEbook-2">없음</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row"><span class="text-primary">품목구분</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col-sm-12 d-flex align-items-center">
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoStb" id="rdoStb-1" value="0" v-model="itemDetail.itemIsStb">
                                                <label for="rdoStb-1">일반</label>
                                            </div>
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoStb" id="rdoStb-2" value="1" v-model="itemDetail.itemIsStb">
                                                <label for="rdoStb-2">STB</label>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <th><span class="text-primary">선택상품</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col col-sm-4 d-flex align-items-center">
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoSelected" id="rdoSelected-1" value="N" v-model="itemDetail.itemSelectedYn">
                                                <label for="rdoSelected-1">일반</label>
                                            </div>
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoSelected" id="rdoSelected-2" value="Y" v-model="itemDetail.itemSelectedYn">
                                                <label for="rdoSelected-2">선택</label>
                                            </div>
                                        </div>
                                        <div class="col col-sm-4">
                                            <input type="text" class="form-control" v-model="itemDetail.itemSelectedTxt">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row"><span class="text-primary">반품유형</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col-sm-12 d-flex align-items-center">
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoRefund" id="rdoRefund-1" value="Y" v-model="itemDetail.itemRefundType">
                                                <label for="rdoRefund-1">가능</label>
                                            </div>
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoRefund" id="rdoRefund-2" value="N" v-model="itemDetail.itemRefundType">
                                                <label for="rdoRefund-2">불가능</label>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <th><span class="text-primary">이전내역 중복체크</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col-sm-12 d-flex align-items-center">
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoDuplicate" id="rdoDuplicate-1" value="Y" v-model="itemDetail.itemDuplicateYn">
                                                <label for="rdoDuplicate-1">체크</label>
                                            </div>
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoDuplicate" id="rdoDuplicate-2" value="N" v-model="itemDetail.itemDuplicateYn">
                                                <label for="rdoDuplicate-2">제외</label>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row"><span class="text-primary">판매여부</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col-sm-12 d-flex align-items-center">
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoUseYn" id="rdoUseYn-1" value="Y" v-model="itemDetail.itemUseYn">
                                                <label for="rdoUseYn-1">판매</label>
                                            </div>
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoUseYn" id="rdoUseYn-2" value="N" v-model="itemDetail.itemUseYn">
                                                <label for="rdoUseYn-2">미판매</label>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <th><span class="text-primary">품목이미지</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col col-sm-4">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row"><span class="text-primary">공급처</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col col-sm-3">
                                            <select class="form-control" v-model="itemDetail.itemProviderNo">
                                                <option value=null>선택하세요</option>
                                                <option v-for="x in cboProviderList" :key="x.providerNo" :value="x.providerNo">{{x.providerName}}</option>
                                            </select>
                                        </div>

                                    </div>
                                </td>
                                <th><span class="text-primary">재고관리 여부</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col-sm-12 d-flex align-items-center">
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoRethinkCheck" id="rdoRethinkCheck-1" value="Y" v-model="itemDetail.itemRethinkCheck">
                                                <label for="rdoRethinkCheck-1">관리</label>
                                            </div>
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoRethinkCheck" id="rdoRethinkCheck-2" value="N" v-model="itemDetail.itemRethinkCheck">
                                                <label for="rdoRethinkCheck-2">미관리</label>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row"><span class="text-primary">취급여부</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col-sm-12 d-flex align-items-center">
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoHandling" id="rdoHandling-1" value="취급" v-model="itemDetail.itemHandling">
                                                <label for="rdoHandling-1">취급</label>
                                            </div>
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoHandling" id="rdoHandling-2" value="단종" v-model="itemDetail.itemHandling">
                                                <label for="rdoHandling-2">단종</label>
                                            </div>
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoHandling" id="rdoHandling-3" value="품절" v-model="itemDetail.itemHandling">
                                                <label for="rdoHandling-3">품절</label>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <th scope="row"><span class="text-primary">재고구분</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col col-sm-3">
                                            <select class="form-control" v-model="itemDetail.itemRethinType">
                                                <option key="" value="">전체</option>
                                                <option key="STB" value="STB">S.T.B</option>
                                                <option key="제품" value="제품">제품</option>
                                                <option key="상품" value="상품">상품</option>
                                                <option key="반제품" value="반제품">반제품</option>
                                                <option key="사은품" value="사은품">사은품</option>
                                                <option key="선급리스자산" value="선급리스자산">선급리스자산</option>
                                                <option key="윤용리스자산" value="윤용리스자산">윤용리스자산</option>
                                            </select>
                                        </div>

                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row"><span class="text-primary">과세구분(매출)</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col-sm-12 d-flex align-items-center">
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoPoserpTax" id="rdoPoserpTax-1" value="0" v-model="itemDetail.poserpTaxType">
                                                <label for="rdoPoserpTax-1">과세</label>
                                            </div>
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoPoserpTax" id="rdoPoserpTax-2" value="1" v-model="itemDetail.poserpTaxType">
                                                <label for="rdoPoserpTax-2">면세</label>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <th><span class="text-primary">과세구분(매입)</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col-sm-12 d-flex align-items-center">
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoTaxationPurchase" id="rdoTaxationPurchase-1" value="0" v-model="itemDetail.itemTaxationPurchase">
                                                <label for="rdoTaxationPurchase-2">과세</label>
                                            </div>
                                            <div class="styled-radio">
                                                <input type="radio" name="rdoTaxationPurchase" id="rdoTaxationPurchase-1" value="1" v-model="itemDetail.itemTaxationPurchase">
                                                <label for="rdoTaxationPurchase-2">면세</label>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row"><span class="text-primary">입고단가</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col col-sm-4">
                                            <input type="text" class="form-control" v-model="itemDetail.itemImportPrice">
                                        </div>

                                    </div>
                                </td>
                                <th><span class="text-primary">소비자가</span></th>
                                <td>
                                    <div class="row">
                                        <div class="col col-sm-4">
                                            <input type="text" class="form-control" v-model="itemDetail.itemSaleprice">
                                        </div>

                                    </div>
                                </td>
                            </tr>

                            <tr>
                                <th scope="row"><span class="text-primary">메모</span></th>
                                <td colspan="3">
                                    <div class="row">
                                        <div class="col col-sm-12">
                                            <input type="text" class="form-control" v-model="itemDetail.itemNote">
                                        </div>

                                    </div>
                                </td>
                            </tr>

                        </tbody>
                    </table>
                </div>

                <div class="widget-footer">
                    <div class="row col">
                        <div class="col-sm-6">
                            <button type="button" class="btn btn-outline-primary" @click="$router.push({name: 'baseItems'})">목록</button>
                            <button type="button" class="btn btn-outline-danger" v-show="itemDetail.idNum !== ''">삭제</button>
                            <button type="button" class="btn btn-outline-primary" @click="init">신규품목</button>
                        </div>
                        <div class="col-sm-6 d-flex justify-content-end">
                            <button type="button" class="btn btn-primary" @click="saveItem">저장</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 입력폼 끝-->

        </div>
    </div>
  </div>
</template>

<script>
import { mapGetters, mapActions } from 'vuex'
import pageHeader from '@/mixin/pageHeader'

const itemStore = 'itemStore'

export default {
  name: 'baseItemsInput',
  mixins: [pageHeader({title: '품목등록', groupName: '기초관리'})],
  data () {
    return {
      cboBicCodeList: [], /* 대분류코드 Combo */
      cboMidCodeList: [], /* 중분류코드 Combo */
      cboSmallCodeList: [], /* 소분류코드 Combo */
      cboBicCodeVal: '', /* 대분류코드 */
      cboMidCodeVal: '', /* 중분류코드 */
      cboSmallCodeVal: '', /* 소분류코드 */
      cboBrandList: [], /* 브랜드 Combo */
      cboProviderList: [], /* 공급처 Combo */
      itemDetail: {}
    }
  },
  created () {
    this.findItemDetail() // 품목코드목록 조회
    this.findBrand() // 브랜드 조회
    this.findProvider() // 공급처 조회
  },
  mounted () {

  },
  computed: {
    ...mapGetters(itemStore, [
      'getCategoryCodeList', /* 품목코드목록 */
      'getItemDetail',
      'getVenBrandList',
      'getVenProviderList'
    ])
  },
  methods: {
    ...mapActions(itemStore, [
      'actionFindItemDetail',
      'actionFindBrand',
      'actionFindProvider',
      'actionSaveItem'
    ]),
    init: function () {
      this.cboBicCodeList = this.getCategoryCodeList.filter(x => x.icParentNo === null) // 대분류코드
      this.cboMidCodeList = [] /* 중분류코드 Combo */
      this.cboSmallCodeList = [] /* 소분류코드 Combo */
      this.cboBicCodeVal = '' /* 대분류코드 */
      this.cboMidCodeVal = '' /* 중분류코드 */
      this.cboSmallCodeVal = '' /* 소분류코드 */
      this.itemDetail = {
        idNum: '', /* 품목상세 코드 */
        itemId: '', /* 품목 코드 */
        itemName: '', /* 품목명 */
        icCodeNo: '', /* 품목 분류 코드 */
        iedtBarcode: '', /* 관리번호 */
        itemStandard: '', /* 규격 */
        itemProviderNo: null, /* 공급처 */
        providerName: '', /* 공급처명 */
        itemRethinkCheck: 'Y', /* 재고관리여부 */
        itemHandling: '취급', /* 취급여부 */
        itemRethinType: '', /* 재고구분 */
        poserpTaxType: '1', /* 과세구분(매출) */
        itemTaxationPurchase: '1', /* 과세구분(매입) */
        itemImportPrice: '', /* 입고 단가 */
        itemSaleprice: '', /* 소비자가 */
        itemNote: '', /* 메모 */
        cuRegdate: '', /* 생성 날짜 */
        cuLastdate: '', /* 수정 날짜 */
        itemUseYn: 'Y', /* 사용여부 */
        itemAuthor: '', /* 저자 */
        itemManufacture: '', /* 제조사(출판사) */
        itemBrandNo: null, /* 브랜드번호 */
        itemYear: '', /* year */
        itemPage: '', /* page */
        itemCdYn: 'N', /* cd */
        itemEbookYn: 'N', /* ebook */
        itemIsStb: '0', /* STB */
        itemSelectedYn: 'N', /* 선택 */
        itemSelectedTxt: '', /* 선택TEXT */
        itemRefundType: 'N', /* 반품유형 */
        itemDuplicateYn: 'N' /* 이전내역 중복체크 */
      }
    },
    // **********************************************
    // #region  store API
    // **********************************************
    // 품목코드목록 조회
    findItemDetail: async function f () {
      await this.actionFindItemDetail(this.$route.params.itemId)
      this.itemDetail = this.getItemDetail
      // 품목분류코드 셋팅
      if (this.itemDetail.icCodeNo !== null && this.itemDetail.icCodeNo !== '') {
        let smallCodeObj = this.getCategoryCodeList.filter(x => x.icCodeNo === this.itemDetail.icCodeNo)[0]
        let midCodeObj = this.getCategoryCodeList.filter(x => x.icCodeNo === smallCodeObj.icParentNo)[0]
        let bicCodeObj = this.getCategoryCodeList.filter(x => x.icCodeNo === midCodeObj.icParentNo)[0]
        this.cboSmallCodeList = this.getCategoryCodeList.filter(x => x.icParentNo === smallCodeObj.icParentNo)
        this.cboMidCodeList = this.getCategoryCodeList.filter(x => x.icParentNo === midCodeObj.icParentNo)
        this.cboBicCodeList = this.getCategoryCodeList.filter(x => x.icParentNo === bicCodeObj.icParentNo)
        this.cboSmallCodeVal = smallCodeObj.icCodeNo
        this.cboMidCodeVal = midCodeObj.icCodeNo
        this.cboBicCodeVal = bicCodeObj.icCodeNo
      } else {
        this.cboBicCodeList = this.getCategoryCodeList.filter(x => x.icParentNo === null) // 대분류코드
      }
    },
    // 품목 저장
    saveItem: function () {
      if (this.cboBicCodeVal !== '' && this.cboBicCodeVal !== null) {
        this.itemDetail.icCodeNo = this.cboBicCodeVal
      }
      if (this.cboMidCodeVal !== '' && this.cboMidCodeVal !== null) {
        this.itemDetail.icCodeNo = this.cboMidCodeVal
      }
      if (this.cboSmallCodeVal !== '' && this.cboSmallCodeVal !== null) {
        this.itemDetail.icCodeNo = this.cboSmallCodeVal
      }

      if (this.itemDetail.icCodeNo === '' || this.itemDetail.icCodeNo === null) {
        alert('품목 분류를 선택하세요.')
        return
      }
      if (this.itemDetail.itemName === '' || this.itemDetail.itemName === null) {
        alert('품목명을 입력하세요.')
        return
      }
      if (this.itemDetail.itemBrandNo === '' || this.itemDetail.itemBrandNo === null) {
        alert('브랜드를 선택하세요.')
        return
      }
      if (this.itemDetail.itemProviderNo === '' || this.itemDetail.itemProviderNo === null) {
        alert('공급처를 선택하세요.')
        return
      }
      if (this.itemDetail.iedtBarcode === '' || this.itemDetail.iedtBarcode === null) {
        alert('관리번호를 입력하세요.')
        return
      }
      if (this.itemDetail.itemImportPrice === '' || this.itemDetail.itemImportPrice === null) {
        alert('입고단가를 입력하세요.')
        return
      }
      if (this.itemDetail.itemSaleprice === '' || this.itemDetail.itemSaleprice === null) {
        alert('소비자가를 입력하세요.')
        return
      }
      this.actionSaveItem(this.itemDetail).then(res => { debugger })
    },
    // 브랜드 조회
    findBrand: async function f () {
      await this.actionFindBrand()
      this.cboBrandList = this.getVenBrandList
    },
    // 공급처 조회
    findProvider: async function f () {
      await this.actionFindProvider()
      this.cboProviderList = this.getVenProviderList
    },
    // #endregion
    // **********************************************

    // **********************************************
    // #region  Event
    // **********************************************
    // 품목 대분류 selectBox Change
    changeCboBicCode () {
      this.cboMidCodeVal = ''
      this.cboMidCodeList = this.getCategoryCodeList.filter(x => x.icParentNo === this.cboBicCodeVal)
    },
    // 품목 중분류 selectBox Change
    changeCboMidCode () {
      this.cboSmallCodeVal = ''
      this.cboSmallCodeList = this.getCategoryCodeList.filter(x => x.icParentNo === this.cboMidCodeVal)
    }
    // #endregion
    // **********************************************
  }
}
</script>

<style>

</style>
